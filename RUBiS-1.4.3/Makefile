# Main Makefile #

include config.mk

####################
#   EJB versions   #
####################

db_id:
	cd EJB_DB_id ; make all

eb_id:
	cd EJB_EntityBean_id ; make all


#########################
#    Servlets version   #
#########################

servlets: 
	cd Servlets ; make all

####################
#       Client     #
####################

client:
	cd Client ; make all

initDB:
	${JAVA} -classpath ./Client:./database edu.rice.rubis.client.InitDB ${PARAM}

emulator:
	${JAVA} -Xmx1g -Xss64k -classpath ./Client edu.rice.rubis.client.ClientEmulator


############################
#       Global rules       #
############################

DIRS = Client Servlets EJB_DB_id EJB_EntityBean_id EJB_SessionBean EJB_Session_facade

all: flush_cache
	-for d in ${DIRS}; do (cd $$d && ${MAKE} all); done

world: all javadoc

javadoc :
	-for d in ${DIRS}; do (cd $$d && ${MAKE} javadoc); done

clean:
	-for d in ${DIRS}; do (cd $$d && ${MAKE} clean); done

flush_cache: bench-scripts/flush_cache.c
	gcc bench-scripts/flush_cache.c -o bench-scripts/flush_cache
